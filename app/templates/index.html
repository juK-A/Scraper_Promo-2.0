<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mercado Livre Scraper</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🛒</text></svg>" />
  </head>
  <body>
    <!-- Botão de toggle do modo escuro -->
    <button class="theme-toggle" id="themeToggle" title="Alternar modo escuro">
      🌙
    </button>
    
    <div class="container">
      <div class="header">
        <h1>🛒 Mercado Livre Scraper</h1>
        <p>Encontre os melhores produtos e preços do Mercado Livre</p>
      </div>

      <div class="search-section">
        <div class="tabs">
          <button class="tab-btn active" onclick="showTab('busca', this)">
            🔍 Buscar Produtos
          </button>
          <button class="tab-btn" onclick="showTab('link', this)">
            🔗 Analisar Link
          </button>
          <button class="tab-btn" onclick="showTab('webhook', this)">
            📢 Enviar Webhook
          </button>
          <button class="tab-btn" onclick="showTab('agendamento', this)">
            📅 Agendamento
          </button>
        </div>

        <div id="tab-busca" class="tab-content active">
          <form class="search-form" id="searchForm">
            <div class="form-group">
              <label for="produto">Produto</label>
              <input
                type="text"
                id="produto"
                name="produto"
                placeholder="Ex: smartphone samsung"
                required
              />
            </div>
            <div class="form-group" style="flex: 0 0 150px">
              <label for="maxPages">Páginas</label>
              <select id="maxPages" name="maxPages">
                <option value="1">1 página</option>
                <option value="2">2 páginas</option>
                <option value="3" selected>3 páginas</option>
                <option value="5">5 páginas</option>
              </select>
            </div>
            <div class="form-group" style="flex: 0 0 auto">
              <button type="submit" class="btn" id="searchBtn">
                Buscar Produtos
              </button>
            </div>
          </form>
        </div>

        <div id="tab-link" class="tab-content">
          <form class="search-form" id="linkForm">
            <div class="form-group">
              <label for="produtoUrl">Link do Produto (Mercado Livre)</label>
              <input
                type="url"
                id="produtoUrl"
                name="produtoUrl"
                placeholder="https://produto.mercadolivre.com.br/..."
                required
              />
            </div>
            <div class="form-group" style="flex: 0 0 auto">
              <button type="submit" class="btn" id="linkBtn">
                Analisar Produto
              </button>
            </div>
          </form>
        </div>

        <div id="tab-webhook" class="tab-content">
          <div class="webhook-container">
            <div class="webhook-header">
              <h3>📤 Envio em Massa para Webhook</h3>
              <p>Adicione produtos para envio automático</p>
            </div>

            <div class="webhook-input-section">
              <div class="input-methods">
                <div class="input-method active" data-method="visual">
                  <span class="method-icon">🎯</span>
                  <span class="method-title">Modo Visual</span>
                </div>
                <div class="input-method" data-method="bulk">
                  <span class="method-icon">📝</span>
                  <span class="method-title">Modo em Massa</span>
                </div>
              </div>

              <!-- Modo Visual -->
              <div class="input-content visual-mode active">
                <div class="add-product-card">
                  <div class="add-product-form">
                    <div class="form-row">
                      <div class="form-group">
                        <label for="productUrl">🔗 Link do Produto</label>
                        <input
                          type="url"
                          id="productUrl"
                          placeholder="https://produto.mercadolivre.com.br/..."
                        />
                      </div>
                      <div class="form-group">
                        <label for="affiliateUrl"
                          >💰 Link de Afiliado (opcional)</label
                        >
                        <input
                          type="url"
                          id="affiliateUrl"
                          placeholder="https://link.afiliado..."
                        />
                      </div>
                    </div>
                    <button
                      type="button"
                      class="btn add-product-btn"
                      id="addProductBtn"
                    >
                      ➕ Adicionar Produto
                    </button>
                  </div>
                </div>

                <div class="products-queue" id="productsQueue">
                  <div class="queue-header">
                    <h4>
                      🎯 Produtos na Fila <span class="queue-count">(0)</span>
                    </h4>
                    <button
                      type="button"
                      class="btn-secondary clear-queue-btn"
                      id="clearQueueBtn"
                    >
                      🗑️ Limpar Fila
                    </button>
                  </div>
                  <div class="queue-list" id="queueList">
                    <div class="queue-empty">
                      <span class="empty-icon">📦</span>
                      <p>Nenhum produto na fila</p>
                      <small>Adicione produtos usando o formulário acima</small>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Modo em Massa -->
              <div class="input-content bulk-mode">
                <div class="bulk-input-card">
                  <label for="webhookUrls"
                    >📝 Lista de Links (Formato:
                    link_produto,link_afiliado)</label
                  >
                  <textarea
                    id="webhookUrls"
                    name="webhookUrls"
                    placeholder="Cole a lista de links aqui, um par por linha.&#10;Ex: https://produto.mercadolivre...,https://link.afiliado..."
                    rows="12"
                  ></textarea>
                  <div class="bulk-actions">
                    <button
                      type="button"
                      class="btn-secondary"
                      id="clearWebhookTextareaBtn"
                    >
                      🗑️ Limpar Lista
                    </button>
                    <button type="button" class="btn" id="importFromBulkBtn">
                      📥 Importar para Fila Visual
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="webhook-actions">
              <form id="webhookForm">
                <button
                  type="submit"
                  class="btn-primary process-webhook-btn"
                  id="webhookBtn"
                >
                  <span class="btn-icon">🚀</span>
                  <span class="btn-text">Processar Fila</span>
                  <span class="btn-badge" id="processCount">0</span>
                </button>
              </form>
            </div>
          </div>
        </div>
        <div id="tab-agendamento" class="tab-content">
          <div class="search-section">
            <form class="search-form" id="filtroAgendamentoForm">
              <div class="form-group">
                <label for="filtroStatus">Status</label>
                <select id="filtroStatus" name="status">
                  <option value="agendado">Agendado</option>
                  <option value="nao-agendado">Não Agendado</option>
                  <option value="todos">Todos</option>
                </select>
              </div>
              <div class="form-group">
                <label for="filtroOrdem">Ordenar por</label>
                <select id="filtroOrdem" name="ordem">
                  <option value="desc">Mais Recentes</option>
                  <option value="asc">Mais Antigos</option>
                </select>
              </div>
            </form>
            <div id="agendamento-list-container">
              <h3>Produtos na Base de Dados:</h3>
              <div id="agendamento-list" class="products-grid">
                <p>Carregando produtos...</p>
              </div>
            </div>
          </div>
        </div>

        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p>Processando...</p>
        </div>
      </div>

      <div class="results-section" id="resultsSection">
        <div class="results-header">
          <div class="results-count" id="resultsCount"></div>
          <button class="clear-btn" id="clearBtn">Limpar Resultados</button>
        </div>
        <div class="products-grid" id="productsGrid"></div>
      </div>

      <div class="results-section" id="produtoSection" style="display: none">
        <div class="results-header">
          <div class="results-count">Produto Analisado</div>
          <button class="clear-btn" id="clearProdutoBtn">Limpar</button>
        </div>
        <div id="produtoDetalhado"></div>
      </div>

      <div
        class="results-section"
        id="webhookMessageSection"
        style="display: none"
      >
        <div class="results-header">
          <div class="results-count">Resposta do Webhook</div>
          <button class="clear-btn" id="clearWebhookBtn">Limpar</button>
        </div>
        <div id="webhookMessageContent"></div>
      </div>
    </div>

    <div id="agendamentoModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Agendar Envio</h2>
          <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body">
          <form id="agendamentoForm">
            <input type="hidden" id="agendarProdutoId" />
            <div class="form-group">
              <label for="agendarData">Data</label>
              <input type="date" id="agendarData" required />
            </div>
            <div class="form-group">
              <label for="agendarHora">Hora</label>
              <input type="time" id="agendarHora" required />
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn">Salvar Agendamento</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <div id="editarModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Editar Produto</h2>
          <span class="close" onclick="closeEditModal()">&times;</span>
        </div>
        <div class="modal-body">
          <form id="editarForm">
            <input type="hidden" id="editarProdutoId" />
            <div class="form-group">
              <label for="editarImagemUrl">Link da Imagem</label>
              <input
                type="url"
                id="editarImagemUrl"
                placeholder="https://exemplo.com/imagem.jpg"
                oninput="updateImagePreview()"
              />
              <small style="color: #666; margin-top: 5px; display: block">
                Cole aqui o novo link da imagem do produto
              </small>

              <div
                id="imagePreviewContainer"
                style="margin-top: 15px; text-align: center"
              >
                <div
                  id="imagePreviewLabel"
                  style="font-weight: 500; margin-bottom: 8px; color: #333"
                >
                  Preview da Imagem:
                </div>
                <div
                  id="imagePreviewWrapper"
                  style="
                    border: 2px dashed #ddd;
                    border-radius: 10px;
                    padding: 20px;
                    background-color: #fafafa;
                    min-height: 200px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                  "
                >
                  <img
                    id="imagePreview"
                    style="
                      max-width: 100%;
                      max-height: 200px;
                      border-radius: 8px;
                      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
                      display: none;
                    "
                    alt="Preview da imagem"
                  />
                  <div
                    id="imagePreviewPlaceholder"
                    style="color: #999; font-style: italic"
                  >
                    📷 Nenhuma imagem para mostrar
                  </div>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="editarMensagem">Mensagem</label>
              <textarea
                id="editarMensagem"
                rows="8"
                placeholder="Digite a mensagem personalizada para este produto..."
                style="
                  width: 100%;
                  padding: 10px;
                  font-size: 14px;
                  border-radius: 10px;
                  border: 2px solid #e1e8ed;
                  resize: vertical;
                  font-family: inherit;
                "
              ></textarea>
              <small style="color: #666; margin-top: 5px; display: block">
                Esta será a mensagem enviada quando o produto for processado
              </small>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn-excluir"
                onclick="closeEditModal()"
              >
                Cancelar
              </button>
              <button type="submit" class="btn">Salvar Alterações</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>
